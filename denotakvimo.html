<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>denotakvimo</title>

<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-title" content="denotakvimo">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
:root {
  --glass-bg: rgba(255, 255, 255, 0.15);
  --glass-blur: 15px;
  --text-color: #ffffff;
}

body {
  margin: 0; padding: 0;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: #2c3e50 url('https://images.unsplash.com/photo-1534067783941-51c9c23ecefd?q=80&w=2000') no-repeat center center fixed;
  background-size: cover;
  color: var(--text-color);
  height: 100vh; overflow: hidden;
}

.overlay { background: rgba(0, 0, 0, 0.3); height: 100vh; width: 100vw; display: flex; flex-direction: column; }

header {
  padding: env(safe-area-inset-top) 20px 10px 20px;
  display: flex; justify-content: space-between; align-items: center;
  background: rgba(0,0,0,0.5); backdrop-filter: blur(20px);
}

#calendar { display: grid; grid-template-columns: repeat(7, 1fr); grid-template-rows: repeat(6, 1fr); gap: 5px; height: 100%; padding: 10px; }

.day {
  background: var(--glass-bg); backdrop-filter: blur(var(--glass-blur));
  border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;
  padding: 6px; cursor: pointer; display: flex; flex-direction: column; overflow: hidden;
}

.day.selected { border: 2px solid white; background: rgba(255,255,255,0.3); }

.inner-event {
  font-size: 0.6rem; padding: 2px 4px; border-radius: 4px; margin-top: 2px;
  background: rgba(0,0,0,0.3); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

.inner-event.completed { text-decoration: line-through; opacity: 0.5; }

.bottom-panel {
  background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(30px);
  padding: 15px 15px calc(env(safe-area-inset-bottom) + 10px) 15px;
}

.input-group { display: flex; gap: 6px; margin-top: 10px; flex-wrap: wrap; }

input, button, select {
  background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
  color: white; padding: 10px; border-radius: 10px; outline: none; font-size: 0.9rem;
}

select option { background: #333; color: white; }

button.primary { background: white; color: #333; font-weight: bold; border: none; flex-grow: 1; }

.empty { visibility: hidden; }
</style>
</head>
<body>

<div class="overlay">
  <header>
    <div>
      <button onclick="changeMonth(-1)">‚óÄ</button>
      <span id="monthYear" style="font-weight: bold; margin: 0 10px;"></span>
      <button onclick="changeMonth(1)">‚ñ∂</button>
    </div>
    <div style="display:flex; gap:10px;">
      <input type="color" id="mainColorPicker" style="width:30px; height:30px; border-radius:50%; padding:0; border:none;">
      <label for="bgInput" style="cursor: pointer; font-size: 1.2rem;">üñºÔ∏è</label>
      <input type="file" id="bgInput" accept="image/*">
    </div>
  </header>

  <div style="flex-grow:1; display:flex; flex-direction:column;">
    <div style="display:grid; grid-template-columns:repeat(7,1fr); text-align:center; padding:10px 0; font-size:0.7rem; opacity:0.6;">
      <div>Pzt</div><div>Sal</div><div>√áar</div><div>Per</div><div>Cum</div><div>Cts</div><div>Paz</div>
    </div>
    <div id="calendar"></div>
  </div>

  <div class="bottom-panel">
    <div id="eventListDetail" style="display:flex; gap:8px; overflow-x:auto; padding-bottom:8px;"></div>
    <div class="input-group">
      <select id="isGrumpy">
        <option value="false">üòä Normal</option>
        <option value="true">üòæ Can Sƒ±kƒ±cƒ±</option>
      </select>
      <input type="time" id="timeInput" style="width: 80px;">
      <input type="text" id="textInput" placeholder="Planƒ±nƒ± yaz..." style="flex-grow: 1;">
      <button class="primary" onclick="saveEvent()">üêæ Ekle</button>
    </div>
  </div>
</div>

<script>
let current = new Date();
let selectedDate = null;
const events = JSON.parse(localStorage.getItem("events")) || {};

window.onload = () => {
  const savedBg = localStorage.getItem("customBg");
  const savedColor = localStorage.getItem("customColor");
  if(savedBg) document.body.style.backgroundImage = `url(${savedBg})`;
  else if(savedColor) { document.body.style.backgroundImage = "none"; document.body.style.backgroundColor = savedColor; }
  renderCalendar();
};

document.getElementById('bgInput').onchange = (e) => {
  const reader = new FileReader();
  reader.onload = () => {
    document.body.style.backgroundImage = `url(${reader.result})`;
    localStorage.setItem("customBg", reader.result);
  };
  reader.readAsDataURL(e.target.files[0]);
};

function renderCalendar(){
  const calendar = document.getElementById("calendar");
  const monthYear = document.getElementById("monthYear");
  calendar.innerHTML="";
  const y=current.getFullYear(), m=current.getMonth();
  monthYear.textContent = current.toLocaleDateString("tr",{month:"long",year:"numeric"});
  const first = new Date(y,m,1).getDay() || 7;
  const total = new Date(y,m+1,0).getDate();
  let day=1;
  for(let i=1; i<=42; i++){
    const cell = document.createElement("div");
    if(i < first || day > total){ cell.className = "day empty"; } 
    else {
      const dKey = `${y}-${m+1}-${day}`;
      cell.className = "day" + (selectedDate === dKey ? " selected" : "");
      let html = `<div style="font-weight:bold; font-size:0.9rem;">${day}</div>`;
      if(events[dKey]) events[dKey].forEach(ev => {
        const emoji = ev.isGrumpy === "true" ? "üòæ" : "üêà";
        html += `<div class="inner-event ${ev.completed ? 'completed' : ''}">${emoji} ${ev.text}</div>`;
      });
      cell.innerHTML = html;
      const d = day;
      cell.onclick = () => { selectedDate = dKey; updateEventList(); renderCalendar(); };
      day++;
    }
    calendar.appendChild(cell);
  }
}

function updateEventList(){
  const listDiv = document.getElementById("eventListDetail");
  listDiv.innerHTML = events[selectedDate] ? "" : "<small style='opacity:0.5;'>Huzurlu bir g√ºn...</small>";
  if(events[selectedDate]){
    events[selectedDate].forEach((ev, i) => {
      const card = document.createElement("div");
      card.style.cssText = "padding:8px 12px; border-radius:12px; background:rgba(255,255,255,0.15); display:flex; align-items:center; gap:8px; font-size:0.85rem; white-space:nowrap; border: 1px solid rgba(255,255,255,0.1);";
      if(ev.completed) card.style.opacity = "0.4";
      
      const emoji = ev.isGrumpy === "true" ? (ev.completed ? "üòº" : "üòæ") : (ev.completed ? "‚úÖ" : "üêà");
      
      card.innerHTML = `<span onclick="toggleComplete(${i})">${emoji} ${ev.time} ${ev.text}</span> <b onclick="deleteEvent(${i})" style="color:#ff4757; margin-left:5px;">‚úï</b>`;
      listDiv.appendChild(card);
    });
  }
}

function saveEvent(){
  const time = document.getElementById("timeInput").value;
  const text = document.getElementById("textInput").value;
  const isGrumpy = document.getElementById("isGrumpy").value;
  if(!selectedDate || !time || !text) return;
  events[selectedDate] = events[selectedDate] || [];
  events[selectedDate].push({time, text, isGrumpy, completed: false});
  localStorage.setItem("events", JSON.stringify(events));
  document.getElementById("textInput").value = "";
  updateEventList(); renderCalendar();
}

function toggleComplete(i){
  events[selectedDate][i].completed = !events[selectedDate][i].completed;
  localStorage.setItem("events", JSON.stringify(events));
  updateEventList(); renderCalendar();
}

function deleteEvent(i){
  events[selectedDate].splice(i, 1);
  if(events[selectedDate].length === 0) delete events[selectedDate];
  localStorage.setItem("events", JSON.stringify(events));
  updateEventList(); renderCalendar();
}

function changeMonth(n){ current.setMonth(current.getMonth()+n); renderCalendar(); }
</script>
</body>
</html>
